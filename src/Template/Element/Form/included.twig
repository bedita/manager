<property-view inline-template :tab-open="tabsOpen">
<section class="fieldset order-1" id="included" :class="isOpen? '' : 'closed'">

    <header @click.prevent="toggleVisibility()" class="tab unselectable">
        <h2>{{ __('Media') }}</h2>
    </header>

    <div v-show="isOpen" class="tab-container">

        {# Display embedded video if available #}
        {# TODO: embedded html should be provided by `Media` helper #}
        {% if object.attributes.provider_extra.html %}
            <div class="embedded-container"
                style="padding-bottom: {{ 100 * object.attributes.provider_extra.height / object.attributes.provider_extra.width }}%;">
                {{ object.attributes.provider_extra.html|raw }}
            </div>
        {% else %}
            {# the stream #}
            <div class="stream">
                {# thumb #}
                {% if object.type == 'images' %}
                    {# TODO use `Media` helper #}
                    {% set thumb = Thumb.url(object.id, { 'options': { 'w': 600 } } ) %}
                    {% if thumb == constant('App\\View\\Helper\\ThumbHelper::ERROR') %}
                        <p>{{ __('The thumbnail is not available') }}</p>
                        <p>
                            <a href={{ stream.meta.url }} title="{{ __('View original') }}" target="_blank">
                                {{ __('View original') }}
                            </a>
                        </p>
                    {% elseif thumb == constant('App\\View\\Helper\\ThumbHelper::NOT_ACCEPTABLE') %}
                        <p>{{ __('Cannot produce a thumbnail for this file') }}</p>
                    {% elseif thumb == constant('App\\View\\Helper\\ThumbHelper::NOT_READY') %}
                        <p>{{ __('Thumbnail is not ready') }}</p>
                    {% else %}
                        <figure class="thumb">
                            <a href={{ stream.meta.url }} title="{{ __('Open image') }}" target="_blank">
                                <img src={{ thumb }} />
                            </a>
                        </figure>
                    {% endif %}
                {% endif %}
            </div>
        {% endif %}

        {# Display included streams#}
        {% if included %}

        {# cycle over included elements, show only streams #}
        {% for o in included %}
            {% if o.type == 'streams' %}
            {% set stream = o %}

            <div class="stream-properties">
                {# Stream properties #}
                {# Display properties list without edit inputs, they're not changeable #}
                {% set attributes = stream.attributes|merge(stream.meta) %}
                <table>
                    <tbody>
                        {% for akey, val in attributes %}
                        {% if val %}
                            <tr>
                                <th>{{ akey }} :</th>
                                <td>
                                    {% if akey == 'url' %}
                                        <a href={{ val }} target="_blank">{{ val }}</a>
                                    {% else %}
                                        {% if val is iterable %}{{ val|json_encode() }}{% else %}{{ val }}{% endif %}
                                    {% endif %}
                                </td>
                            </tr>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
        {% endfor %}
        {% endif %}

    </div>

</section>
</property-view>
