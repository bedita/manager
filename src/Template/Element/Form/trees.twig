{#
    load-on-start, loading events timing
    800ms  - all folders (tree-view)
    900ms - relations with folders
#}

{% set relationName = 'parents' %}
<property-view inline-template :tab-open="tabsOpen">
    <section class="fieldset order-{{ cssOrder }}" id="trees" :class="isOpen? '' : 'closed'">

    <header @click.prevent="toggleVisibility();" class="tab unselectable" v-bind:class="isLoading? 'is-loading-spinner' : ''">
        <h2>{{ __('Folders') }}</h2>
    </header>

    <div v-show="isOpen" class="tab-container">

        {# TODO put it in config #}
        {% if objectType == 'folders' %}
            {% set relationName = 'parent' %}
            {% set paths = [object.meta.path]%}
            {% set options = { 'multiple': 'false' }%}
        {% else %}
            {% set relationName = 'parents' %}
            {% set paths = included|map(o => o.meta.path ~ '/' ~ object.id) %}
            {% set options = { 'multiple': 'true' }%}
        {% endif %}

        <relation-view
            inline-template
            relation-name={{ relationName }}
            :multiple-choice={{ options.multiple }}

            @loading="onToggleLoading">

            <div class="tree-{{ relationName }} unselectable">
                <tree-view
                    inline-template
                    relation-name={{ relationName }}
                    :object-id={{ object.id }}
                    :object-paths={{ paths|json_encode() }}
                    :multiple-choice="multipleChoice">

                    <div class="tree-view">
                        <div class="tree-entry-list" v-show="Object.keys(objects).length">
                            <tree-list
                                v-for="(child) in objects"
                                :item="child"
                                :object-id="objectId"
                                :object-paths="objectPaths"
                                :relation-name="relationName"
                                :multiple-choice="multipleChoice"
                            ></tree-list>

                        </div>
                    </div>
                </tree-view>
                {{ Form.unlockField('relations.' ~ relationName ~ '.replaceRelated')}}
            </div>
        </relation-view>
    </div>
</section>
</property-view>
