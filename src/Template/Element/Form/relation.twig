{% if relationName == 'children' %}
<children-view inline-template
{% else %}
<relation-view inline-template
    :relation-data='{{ relationSchema|json_encode|raw }}'
{% endif %}
    relation-name={{ relationName }}
    config-paginate-sizes={{ config('Pagination.sizeAvailable')|json_encode()|raw }}
    ref="relation"
    @loading="onToggleLoading" @count="onCount">

    <div class="relation-view">

        <div class="related-list-container">

            {# FilterBoxView #}
            <div class="mb-1" v-if="pagination.count">
                <filter-box-view
                    :config-paginate-sizes="configPaginateSizes"
                    :pagination.sync="pagination"
                    :show-filter-buttons="false"
                    :relation-types="relationTypes"
                    :init-filter="activeFilter"
                    objects-label="{{ __('objects') }}"
                    @filter-update-current-page="onUpdateCurrentPage"
                    @filter-update-page-size="onUpdatePageSize"
                    @filter-objects="onFilterObjects"
                    inline-template>

                        {% element 'FilterBox/filter_box' %}

                </filter-box-view>
            </div>

            {# RELATED OBJECTS #}
            <div class="mb-1" v-show="objects.length">
                <div class="columns" droppable sortable>
                    <div
                        class="related-item-column column is-3 is-one-half-mobile is-one-third-tablet is-one-quarter-desktop is-one-fifth-widescreen is-one-sixth-fullhd"
                        v-for="(related, index) in objects"
                        :key="related.id"
                        :class="containsId(removedRelated, related.id)? 'removed' : ''"
                        draggable
                        :drag-data="JSON.stringify(related)">

                        {% if relationName == 'children' %}
                            {% element 'Form/related_item' { 'children': true } %}
                        {% else %}
                            {% element 'Form/related_item' { 'common': true } %}
                        {% endif %}
                    </div>
                </div>
            </div>

            {# STAGED OBJECTS #}
            <div class="mb-1 has-background-gray-950 p-1" v-if="addedRelations.length">
                <p class="has-text-size-smallest mb-1">{{ __('New relations (save to keep)') }}</p>
                <div class="columns">
                    <div
                        class="related-item-column column is-3 is-one-half-mobile is-one-third-tablet is-one-quarter-desktop is-one-fifth-widescreen is-one-sixth-fullhd"
                        v-for="related in addedRelations"
                        :key="related.id"
                        :class="containsId(removedRelated, related.id) ? 'removed' : '' ">

                        {% element 'Form/related_item' { 'stage': true } %}
                    </div>
                </div>
            </div>

            {# hidden field - relations serialized json #}
            {{ Form.control(relationName ~ 'removeRelated', {
                'type': 'hidden',
                'name': 'relations[' ~ relationName ~ '][removeRelated]',
                'v-model': 'removedRelationsData'
            })|raw }}
            {{ Form.unlockField('relations.' ~ relationName ~ '.removeRelated')}}

            {# Relations serialized json form element #}
            {{ Form.control(relationName ~ 'addRelated', {
                'type': 'hidden',
                'name': 'relations[' ~ relationName ~ '][addRelated]',
                'v-model': 'addedRelationsData'
            })|raw }}
            {{ Form.unlockField('relations.' ~ relationName ~ '.addRelated')}}
        </div>

        <div class="mt-5">
            {# DROP FILES #}
            {% set types = ['media', 'images', 'videos', 'audio', 'files'] %}
            {% set acceptedTypes = types | filter((item) => item in relationSchema.right) | join(', ') %}
            {% if acceptedTypes|length %}
                {# :accepted-drop="[`.from-relation-${relationName}`,isRelationWithMedia && 'from-files']"> #}

                <drop-upload
                    placeholder="{{ __('Click or drop new files here') }}"
                    @new-relations="appendRelations"
                    ></drop-upload>
            {% endif %}

            <div>
                <button v-if="isPanelOpen({{object.id|json_encode}})" class="icon-coffee"
                    @click.prevent.stop="closePanel()">{{ __('cancel') }}</button>

                <button v-else
                    class="icon-hdd"
                    @click.prevent.stop="addRelatedObjects({
                        object: {{object|json_encode}},
                        relationName: relationName,
                        alreadyInView: alreadyInView,
                        relationTypes: relationTypes,
                    })">{{ __('add objects') }}</button>
            </div>
        </div>

    </div>
</relation-view>
