<script type="text/javascript">
$(document).ready(function(){
    $('textarea.json').change(function(event){
        if (event && event.target && event.target.value) {
            try {
                let jsonString = JSON.stringify(JSON.parse(event.target.value), null, "    ");
                $(event.target).val(jsonString);
            } catch(e) {
                console.error(e);
            }
        }
    });
    $('textarea.json').each(function(){
        if (this.value) {
            try {
                let jsonString = JSON.stringify(JSON.parse(this.value), null, "    ");
                $(this).val(jsonString);
            } catch(e) {
                console.error(e);
            }
        }
    });
});
</script>

<div class="tab"><h2>{{ __('Other Properties') }}</h2></div>

<fieldset id="object_properties">

{% set jsonKeys = [] %}
{% for key, value in object.attributes %}
    {% if not in_array(key, ['title', 'description', 'uname', 'status']) %}
        {% set property = schema.properties[key] %}
        {% set type = Schema.getTypeFromSchema(property) %}
        {% if type == 'json' %}
            {% set jsonKeys = jsonKeys|merge([key]) %}
            {{ Form.control(key, {'type': 'textarea', 'class': 'json', 'value': value|json_encode})|raw }}
        {% else %}
            {{ Form.control(key, {'type': Schema.getControlTypeFromSchema(property)})|raw }}
        {% endif %}
    {% endif %}
{% endfor %}
{% if jsonKeys %}
    {{ Form.control('_jsonKeys', {'type': 'hidden', 'value': jsonKeys|join(',')})|raw }}
{% endif %}


</fieldset>
