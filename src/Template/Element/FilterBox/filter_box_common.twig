{% set filterActive = (_view.request.getQuery('filter') or _view.request.getQuery('q')) %}

<div class="filters-container{{ filterActive ? ' filters-container-active' : '' }}">
    <div class="basic-filters">
        {# search #}
        <div class="filter-container filter-search input">
            <input type="text"
                :placeholder="placeholder"
                v-model="queryFilter.q"
                @keyup.prevent.stop="onQueryStringKeyup"
                @change="onQueryStringChange"
                @keyup.enter.prevent.stop="applyFilter" />
        </div>

        <button class="button button-secondary button-primary-hover-module-{{ currentModule.name }}"
            @click.prevent="applyFilter()"
        >
            {{ __('Search') }}
        </button>

        <button class="toggle-filters button button-outlined" @click="moreFilters = !moreFilters">
            <span v-if="!moreFilters">{{ __('More filters') }}</span>
            <span v-else>{{ __('Less filters') }}</span>
        </button>

        {# Checkbox my contents #}
        <div class="filter-container checkbox">
            <label>
                <input type="checkbox" v-model="queryFilter.filter['history_editor']">{{ __('Only my contents') }}</input>
            </label>
        </div>

        <button class="button button-outlined" @click.prevent="resetFilter()">{{ __('Reset filters') }}</button>
    </div>

    <div class="more-filters" v-show="moreFilters">
        {# status filter #}
        <div class="filter-container" v-if="statusFilter.options">
            <label v-for="s in statusFilter.options">
                <input type="checkbox" :id="s.value" :name="statusFilter.name" :value="s.value" v-model="selectedStatuses">
                <: s.text :>
            </label>
        </div>

        {# dynamic filter object types #}
        <div class="filter-container search-types" v-if="rightTypes.length > 1">
            <select v-model="queryFilter.filter.type" @change="onOtherFiltersChange">
                <option value="" label="{{ __('All Types') }}"></option>
                <option v-for="type in rightTypes"><: t(type) :></option>
            </select>
        </div>

        {# other dynamic filters #}
        <div v-for="filter in dynamicFilters" class="filter-container" :class="[filter.name, filter.type, filter.date ? 'date' : '']">
            <input type="hidden" :name="filter.name" :value="filter.value">
            <label><: filter.name | humanize :></label>

            <span v-if="filter.type === 'select' || filter.type === 'radio'">
                <select v-model="queryFilter.filter[filter.name]" :id="filter.name">
                    <option value="">
                        {{ __('All') }}
                    </option>
                    <option v-for="option in filter.options" v-if="option.text" :name="option.name" :value="option.value">
                        <: option.text :>
                    </option>
                </select>
            </span>

            <span v-else-if="filter.type === 'checkbox'">
                <label>
                    <input type="radio" v-model="queryFilter.filter[filter.name]" value="">
                    {{ __('Any') }}
                </label>
                <label>
                    <input type="radio" v-model="queryFilter.filter[filter.name]" value="true">
                    {{ __('Yes') }}
                </label>
                <label>
                    <input type="radio" v-model="queryFilter.filter[filter.name]" value="false">
                    {{ __('No') }}
                </label>
            </span>

            <span v-if="filter.name === 'date_ranges'">
                <label>{{ __('From date') }}
                    <input-dynamic-attributes :value.sync="queryFilter.filter['date_ranges']['from_date']" :attrs="filter" />
                </label>
                <label>{{ __('To date') }}
                    <input-dynamic-attributes :value.sync="queryFilter.filter['date_ranges']['to_date']" :attrs="filter" />
                </label>
            </span>

            <span v-else-if="filter.date">
                <label>{{ __('From') }}
                    <input-dynamic-attributes :value.sync="queryFilter.filter[filter.name]['gte']" :attrs="filter" />
                </label>
                <label>{{ __('To') }}
                    <input-dynamic-attributes :value.sync="queryFilter.filter[filter.name]['lte']" :attrs="filter" />
                </label>
            </span>

            <span v-else-if="filter.type === 'text' || filter.type === 'number'">
                <input-dynamic-attributes :value.sync="queryFilter.filter[filter.name]" :attrs="filter"/>
            </span>
        </div>

        {% if schema.categories|length > 0 %}
        <div class="filter-container" v-if="filterList.some(f => f.name === 'categories')">
            <category-picker
                :categories="{{ schema.categories|json_encode }}"
                id="category-filter"
            />
            {{ Form.unlockField('categoriesSelected') }}
        </div>
        {% endif %}

        <div class="filter-container">
            <folder-picker />
            {{ Form.unlockField('folderSelected') }}
        </div>
    </div>
</div>

{% if filterActive %}
<div>
    <p class="is-expanded tag mt-1">
        {{ __('Data is filtered') }}
    </p>
</div>
{% endif %}
