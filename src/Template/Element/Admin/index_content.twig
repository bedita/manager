{% element ('Admin/sidebar') %}

{% do _view.assign('title', 'Administration ' ~ resourceType|humanize) %}
{% do _view.assign('bodyViewClass',  'view-module view-model') %}

<div class="module-header">
    <header>
        <h1>{{ title }}</h1>
    </header>
</div>

{% element 'Modules/index_header' { 'meta': meta, 'hideFilter': 1, 'Schema': Schema, 'hidePagination': treeView} %}

<div class="module-index">
    <div class="list-objects">

        {# list resources : table header #}
        <nav class="table-header has-border-black">
            <div>{{ __('Id') }}</div>
            {% for key in properties %}
                {% set label = key %}
                <div class="{{ Link.sortClass(key) }}"><a href="{{ Link.sortUrl(key) }}">{{ __(label)|humanize }}</a></div>
            {% endfor %}
            {% for key in metaColumns %}
                <div>{{ key }}</div>
            {% endfor %}
            {% if not readonly %}
                <div></div>
            {% endif %}
        </nav>
        {% if resources|count == 0 %}
            <p>{{ __('Resources not available') }}</p>
        {% endif %}

        {# list resources : rows #}
        {% for resource in resources %}

            {{ Form.create(null, {
                'url': {'_name': 'admin:save:' ~ resourceType},
                'id': 'form-' ~ resource.id,
                'class': 'table-row',
            })|raw }}
                <div class="{{ prop }}-cell" untitled-label="{{ __('Untitled') }}">
                    {{ resource.id }}
                </div>
                {% for key in properties %}
                    {% set val = resource.attributes[key] %}
                    <div class="{{ key }}-cell" untitled-label="{{ __('Untitled') }}">
                        {% if readonly %}
                            {{ Schema.format(val, schema.properties[key]) }}
                        {% else %}
                            {{ Property.control(key, val, {'label': ''})|raw }}
                        {% endif %}
                    </div>
                {% endfor %}
                {% for key in metaColumns %}
                    <div class="narrow">
                        {{ Time.format(resource.meta[key], 'd MMM YYYY') }}
                    </div>
                {% endfor %}
                {% if not readonly %}
                    <div class="buttons-cell narrow">
                        {{ Form.button( __('Save'),
                            {
                                'form': 'form-' ~ resource.id,
                                'title': __('Save') ~ resource.attributes.name,
                                'class': 'button button-text-white is-width-auto',
                            })|raw }}

                        {{ Form.postButton(__('Remove'),
                            {'_name': 'admin:remove:' ~ resource.type, 'id': resource.id},
                            {
                                'title': __('Remove') ~ resource.attributes.name,
                                'class': 'button button-text-white is-width-auto',
                            })|raw }}
                    </div>
                {% endif %}

            {{ Form.hidden('id', {'value': resource.id})|raw }}
            {{ Form.end()|raw }}

        {% endfor %}

    </div>

</div>
