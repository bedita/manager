(window.webpackJsonp=window.webpackJsonp||[]).push([["relations-add"],{28:function(t,e,i){"use strict";i.d(e,"b",function(){return a}),i.d(e,"a",function(){return s}),i.d(e,"c",function(){return n});const a={count:0,page:1,page_size:20,page_count:1},s={q:"",filter:{type:[]}},n={data:()=>({requestsQueue:[],requestController:new AbortController,objects:[],endpoint:null,pagination:a,query:{},formatObjetsFilter:["params","priority","position","url"]}),methods:{getPaginatedObjects(t=!0,e={}){let i=window.location.href;if(this.endpoint){e&&(this.query=e);let a=`${i}/${this.endpoint}`;const s={credentials:"same-origin",headers:{accept:"application/json"}};a=this.getUrlWithPaginationAndQuery(a),this.requestsQueue.length>0&&(this.requestController.abort(),this.requestController=new AbortController),s.signal=this.requestController.signal;let n=fetch(a,s).then(t=>t.json()).then(e=>{this.requestsQueue.pop();let i=(Array.isArray(e.data)?e.data:[e.data])||[];return e.data||(i=[]),this.requestsQueue.length<1&&(t&&(this.objects=i),this.pagination=e.meta&&e.meta.pagination||this.pagination,i)}).catch(t=>{if(this.requestsQueue.pop(),20===t.code)throw t;console.error(t)});return this.requestsQueue.push(n),n}return Promise.reject()},formatObjects(t){if(void 0===t)return[];const e=[];return t.forEach(t=>{let i={};i.id=t.id,i.type=t.type;const a=t.meta.relation;if(a){let t={};this.formatObjetsFilter.forEach(e=>{a[e]&&(t[e]=a[e])}),Object.keys(t).length&&(i.meta={relation:t})}e.push(i)}),e},setPagination(t){let e="",i="?";return Object.keys(this.pagination).forEach((t,i)=>{e+=`${i?"&":""}${t}=${this.pagination[t]}`}),-1===t.indexOf(i)||(i="&"),`${t}${i}${e}`},getUrlWithPaginationAndQuery(t){let e="",i="?";return Object.keys(this.pagination).forEach((t,i)=>{e+=`${i?"&":""}${t}=${this.pagination[t]}`}),e.length>1&&(e+="&"),Object.keys(this.query).forEach((t,i)=>{const a=this.query[t];let s=`${t}=${a}`;if("filter"===t){let t="";Object.keys(a).forEach(e=>{""!==a[e]&&(t+=`filter[${e}]=${a[e]}`)}),s=t}e+=`${i?"&":""}${s}`}),-1===t.indexOf(i)||(i="&"),`${t}${i}${e}`},findObjectById(t){let e=this.objects.filter(e=>e.id===t);return e.length&&e[0]},async loadMore(t=a.page_size){if(this.pagination.page_items<this.pagination.count){let e=await this.nextPage(!1);this.pagination.page_items=this.pagination.page_items+t<=this.pagination.count?this.pagination.page_items+t:this.pagination.count;const i=this.objects.length;this.objects.splice(i,0,...e)}},toPage(t,e={}){return this.pagination.page=t||1,this.getPaginatedObjects(!0,e)},firstPage(t=!0){return 1!==this.pagination.page?(this.pagination.page=1,this.getPaginatedObjects(t)):Promise.resolve([])},lastPage(t=!0){return this.pagination.page!==this.pagination.page_count?(this.pagination.page=this.pagination.page_count,this.getPaginatedObjects(t)):Promise.resolve([])},nextPage(t=!0){return this.pagination.page<this.pagination.page_count?(this.pagination.page=this.pagination.page+1,this.getPaginatedObjects(t)):Promise.resolve([])},prevPage(){return this.pagination.page>1?(this.pagination.page=this.pagination.page-1,this.getPaginatedObjects()):Promise.resolve()},setPageSize(t){this.pagination.page_size=t,this.pagination.page=1}}}},83:function(t,e,i){"use strict";i.r(e);var a=i(28),s=i(3),n=i(24);e.default={mixins:[a.c],inject:["getCSFRToken"],components:{FilterBoxView:()=>i.e("filter-box-view").then(i.bind(null,43))},props:{relationName:{type:String,default:""},alreadyInView:{type:Array,default:()=>[]},relationTypes:{type:Object},configPaginateSizes:{type:String,default:"[]"}},data:()=>({method:"relationshipsJson",endpoint:"",loading:!1,selectedObjects:[],activeFilter:{},saving:!1,showCreateObjectForm:!1,file:null,objectType:"",titlePlaceholder:"title"}),computed:{knownTypes:()=>["audio","video","image"],isMedia(){return this.relationTypes&&-1!==this.relationTypes.right.indexOf("media")}},watch:{relationName:{immediate:!0,handler(t,e){t&&(this.selectedObjects=[],this.endpoint=`${this.method}/${t}`,this.loadObjects()),""===t&&Object(n.a)(500).then(()=>this.objects=[])}},loading(t){this.$emit("loading",t)}},methods:{onFilterObjects(t){this.activeFilter=t,this.toPage(1,this.activeFilter)},onUpdatePageSize(t){this.setPageSize(t),this.loadObjects(this.activeFilter)},onUpdateCurrentPage(t){this.toPage(t,this.activeFilter)},addRelationsToObject(){s.a.sendBack("relations-add:save",this.selectedObjects)},closePanel(){s.a.closePanel()},async createObject({target:t}){if(!t)return;this.saving=!0,this.loading=!0;const e=new FormData(t);""===e.get("title")&&e.set("title",this.titlePlaceholder),e.append("model-type",this.objectType);const i=`${window.location.origin}/${this.objectType}/saveJson`,a={method:"POST",credentials:"same-origin",headers:{accept:"application/json","X-CSRF-Token":this.getCSFRToken()},body:e};try{const e=await fetch(i,a),s=await e.json();let n=(Array.isArray(s.data)?s.data:[s.data])||[];this.objects=n.concat(this.objects),this.selectedObjects=n.concat(this.selectedObjects),this.resetForm(t)}catch(e){if(20===e.code)throw e;alert("Error while uploading/creating new object. Retry"),console.error(e),this.resetForm(t,!0)}finally{this.saving=!1,this.loading=!1}},resetForm(t,e=!1){t.reset(),this.titlePlaceholder="title",this.showCreateObjectForm=e},processFile({target:t}){return this.file=t.files[0],!!this.file&&(this.objectType=this.getObjectType(this.file),this.titlePlaceholder=this.file&&this.file.name,!0)},getObjectType(t){let e=t.type&&t.type.split("/")[0];const i=/audio/g.test(e)?"":"s";return-1===this.knownTypes.indexOf(e)&&(e="file"),`${e}${i}`},paginationPageLinkVisible(t){return this.pagination.page_count<=7||(1===t||t===this.pagination.page_count||t>=this.pagination.page-1&&t<=this.pagination.page+1)},toggle(t,e){let i=this.selectedObjects.indexOf(t);-1!=i?this.selectedObjects.splice(i,1):this.selectedObjects.push(t)},async loadObjects(t){this.objects=[],this.loading=!0;let e=await this.getPaginatedObjects(!0,t);return this.loading=!1,this.$emit("count",this.pagination.count),e},async toPage(t,e){this.objects=[],this.loading=!0;let i=await a.c.methods.toPage.call(this,t,e);return this.loading=!1,i},buildViewUrl:(t,e)=>`${window.location.protocol}/${window.location.host}/${t}/view/${e}`}}}}]);